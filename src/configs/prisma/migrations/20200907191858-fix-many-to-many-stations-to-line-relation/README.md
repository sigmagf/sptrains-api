# Migration `20200907191858-fix-many-to-many-stations-to-line-relation`

This migration has been generated by Joao Gabriel at 9/7/2020, 4:18:58 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."_LineToStation" DROP CONSTRAINT "_LineToStation_A_fkey"

ALTER TABLE "public"."_LineToStation" DROP CONSTRAINT "_LineToStation_B_fkey"

CREATE TABLE "public"."StationsOnLine" (
"position" integer   NOT NULL DEFAULT 1,
"lineId" text   NOT NULL ,
"stationId" text   NOT NULL ,
PRIMARY KEY ("lineId","stationId")
)

ALTER TABLE "public"."StationsOnLine" ADD FOREIGN KEY ("lineId")REFERENCES "public"."Line"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."StationsOnLine" ADD FOREIGN KEY ("stationId")REFERENCES "public"."Station"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."_LineToStation"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200907190859-add2..20200907191858-fix-many-to-many-stations-to-line-relation
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -22,9 +22,9 @@
   number     Int       @unique
   name       String    @unique
   color      String
   active     Boolean?  @default(true)
-  stations   Station[]
+  stations   StationsOnLine[]
   companyId  String
   createdAt  DateTime  @default(now())
   updatedAt  DateTime  @default(now()) @updatedAt
@@ -35,8 +35,18 @@
   id           String    @id
   displayName  String
   fullName     String    @unique
   elevator     Boolean?  @default(false)
-  lines        Line[]
+  lines        StationsOnLine[]
   createdAt    DateTime  @default(now())
   updatedAt    DateTime  @default(now()) @updatedAt
+}
+
+model StationsOnLine {
+  position    Int      @default(1)
+  line        Line     @relation(fields: [lineId], references: [id])
+  lineId      String
+  station     Station  @relation(fields: [stationId], references: [id])
+  stationId   String
+
+  @@id([lineId, stationId])
 }
```


