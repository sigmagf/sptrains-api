# Migration `20200907210025-change-position-to-self-relation-on-stations-on-line`

This migration has been generated by Joao Gabriel at 9/7/2020, 6:00:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."StationsOnLine" ADD COLUMN "id" text   NOT NULL ,
ADD COLUMN "nextId" text   

CREATE UNIQUE INDEX "StationsOnLine.id_unique" ON "public"."StationsOnLine"("id")

CREATE UNIQUE INDEX "StationsOnLine_nextId_unique" ON "public"."StationsOnLine"("nextId")

ALTER TABLE "public"."StationsOnLine" ADD FOREIGN KEY ("nextId")REFERENCES "public"."StationsOnLine"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200907191858-fix-many-to-many-stations-to-line-relation..20200907210025-change-position-to-self-relation-on-stations-on-line
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -41,12 +41,18 @@
   updatedAt    DateTime  @default(now()) @updatedAt
 }
 model StationsOnLine {
+  @@id([lineId, stationId])
+
+  id          String   @unique @default(uuid())
   position    Int      @default(1)
-  line        Line     @relation(fields: [lineId], references: [id])
   lineId      String
-  station     Station  @relation(fields: [stationId], references: [id])
   stationId   String
+  nextId      String?
-  @@id([lineId, stationId])
+  line        Line     @relation(fields: [lineId], references: [id])
+  station     Station  @relation(fields: [stationId], references: [id])
+
+  next        StationsOnLine? @relation("line-station-link", fields: [nextId], references: [id])
+  previous    StationsOnLine? @relation("line-station-link")
 }
```


